<%- include('partials/header'); -%>


  	
    <h2 id = "test">Product By</h2>
    <h1 id = "test">GROUP 13</h1>
   

<link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>

     <button onclick="loadUserData()">Your Devices</button>
     <br> <br>
     <div id="table"></div>


<%- include('partials/footer'); -%>


<script>



function loadUserData() 
{
  
  	var xhr = new XMLHttpRequest();
   

   xhr.open('GET', '/tanks', true);

   xhr.onload = function()
   {
        if(this.status == 200)
        {
          var user = JSON.parse(this.responseText);
          
          console.log(user);

          var table = new Tabulator("#table", {
    data:user.details,           //load row data from array
    layout:"fitColumns",      //fit columns to width of table
    rowFormatter:function(row){
        if(row.getData().tds > 200 || row.getData().turbidity > 5)
        {
            row.getElement().style.backgroundColor = "salmon";
           
        }
        
    },
    responsiveLayout:"hide",  //hide columns that dont fit on the table
    tooltips:true,            //show tool tips on cells
    addRowPos:"top",          //when adding a new row, add it to the top of the table
    history:true,             //allow undo and redo actions on the table
    pagination:"local",       //paginate the data
    paginationSize:7,         //allow 7 rows per page of data
    movableColumns:true,      //allow column order to be changed
    resizableRows:true,       //allow row order to be changed
    initialSort:[             //set the initial sort order of the data
        {column:"name", dir:"asc"},
    ],
    columns:[                 //define the table columns
        {title:"Tank",textarea :true, field:"no", hozAlign:"center",width:100, editor:false},
        {title:"Water Level", field:"level", hozAlign:"left",width:350, formatter:"progress",formatterParams: {max: 1000, color : ["red", "orange", "green"] }, editor:false},
        {title:"Consumption", field:"usage", hozAlign:"left",width:350, formatter:"progress",formatterParams: {max: 1000, color : ["green", "orange", "red"]}, editor:false},
        {title:"TDS Count", field:"tds", hozAlign:"center", width:200, editor:false, formatter:function(cell, formatterParams)
        	{
		       var value = cell.getValue();
		        if(value > 200)
		        {
		            return "<span style='color:red; font-weight:bold;'>" + value + "</span>";
		        }
		        else
		        {
		            return "<span style='color:green; font-weight:bold;'>" + value + "</span>";
		        }
		    }},

        {title:"Turbidity", field:"turbidity",hozAlign:"center", width:200, editor:false, formatter:function(cell, formatterParams)
        	{
		       var value = cell.getValue();
		        if(value > 5)
		        {
		            return "<span style='color:red; font-weight:bold;'>" + value + "</span>";
		        }
		        else
		        {
		             return "<span style='color:green; font-weight:bold;'>" + value + "</span>";
		        }
		    }},


        {title:"Last Updated", field:"updated_at", width:250, sorter:"date", hozAlign:"center"},
     
        
    ]
});
      
        }
      }

      xhr.send();

}







</script>